\section{分子動力学シミュレーション}
\label{sec:md}
本研究では、大きく分けてモデリング、構造最適化、熱平衡化、サンプリング、解析の5つのステップを経た。

\subsection{モデリング}
モデリングでは、欠損部位の補完、結晶水の同定、膜タンパク質の構造準備の3つのステップを経た。

\subsubsection{欠損部位の補完}
PDBに登録されている膜タンパク質の構造データは、全ての残基位置が定まっているわけではない。なぜならX線結晶構造解析において、揺らぎが大きい部位は見えないからである。
$\beta_2$ARでは、MODELERソフトウェアを用いて細胞内ループ3(ICL3)、N末端、C末端の欠損部位を補完した。
MODELERではホモロジーモデリングを利用して、既存のPDBデータから欠損部位の座標を予測した。

\subsubsection{結晶水の同定}

膜タンパク質内の結晶水が重要な役割を果たしていることから、DOWSERを用いてエネルギー的に安定な水分子を同定し、構造に含める作業を行った。
DOWSERはエネルギー的に安定な水分子の位置を計算し、これを構造データに追加することが可能である。この手順により、機能的に重要な膜タンパク質の構造を構築した。

\subsubsection{膜タンパク質の構造準備}
初めに、膜タンパク質と脂質膜の複合体構造は、CHARMM-GUIを用いて作成した。
複合体構築には置換法(Replacement Method)を採用し、タンパク質を囲むように脂質二重膜を配置した。
以下にCHARMM-GUIの設定手順を示す。
\begin{enumerate}
    \item \textbf{初期設定}: CHARMM-GUIサイトで\textit{Protein/Membrane System}を選択し、準備したPDBファイルをアップロード。
    \item \textbf{分子選択}: リガンドと結晶水を含めるように選択。
    \item \textbf{プロトン化とジスルフィド結合の設定}: プロトン化残基やジスルフィド結合を指定。
    \item \textbf{脂質二重膜の構築}: Heterogeneous Lipidを選択し、脂質のXY軸長を80~\AA\ $\times$ 80~\AA\ に設定。
    \item \textbf{イオン追加}: NaCl濃度を0.15Mに設定し、Na+とCl-追加。
\end{enumerate}
分子動力学計算はAmber力場で行うため、CHARMM-GUIで出力されたpdbファイルをAmber形式に変換する。

続いて、リガンドの力場構築には、AmberToolsの\texttt{antechamber}と\texttt{parmchk2}ツールを使用した。

続いて、実際にシミュレーションを行うシステムに対して、プロトン化状態の修正、ジスルフィド結合の形成を行う。
プロトン化状態の修正に関しては、タンパク質構造が与えられた環境下で適切なプロトン化状態を取るように、残基の名前を変更する必要がある。
本研究では、脂質環境下にあるGlu122はGLHに変更し、膜表面側にある残りのGLu,Asp,Arg,Lysは中性(pH=7)での状態を採用した。

最後に、タンパク質-リガンド複合体の分子動力学シミュレーションで用いるためのシミュレーション用のファイルを準備した。
シミュレーションに使用する力場関数に関して、
タンパク質にはff12SB、
脂質にはlipid21、
リガンドにはgaff2、
水分子にはtip3pモデルを用いた。

系のユニットセルサイズはCHARMM-GUIで得られた情報に基づいて、以下のように指定する。
\begin{table}[!ht]
    \centering
    \caption{シミュレーションに用いた系の大きさ}
    \begin{tabular}{lll}
      \hline
      モデル名          & 原子数  & ボックスの大きさ(x, y, z) \\
      \hline 
      inactive(3P0G)  & 84225 & (80.2377, 80.2377, 113.064) \\ 
      active(2RH1)    & 70608 & (80.0239, 80.0239, 136.043) \\ 
    \end{tabular}
    \label{tab:system_size}
  \end{table}
  

\subsection{構造最適化}
構造最適化は3つのステップに分けて行った。
全てのステップにおいて、最急降下法で最小化を開始し、200ステップ後に共役勾配法(CG法)へ切り替えている。
初めに、水素以外の全ての原子に位置制約を課し、タンパク質周辺の脂質や水分子の構造最適化を行った。
続いて、膜タンパク質の主鎖原子、リガンドの重原子、脂質のhead部分に位置制約を課し、膜タンパク質の側鎖原子や水分子の構造最適化を行った。
最後に、上記の束縛力を弱めて、全体の構造を最適化した。

\subsection{熱平衡化}
熱平衡化は4つのステップに分けて行った。
初めに、NVTアンサンブルで系を徐々に加熱させた。
初期速度は温度$T = 0 \rm{[K]}$のマクスウェル分布に従って与え、 
100 $\rm{ps}$で温度を$T = 310 \rm{[K]}$まで上昇させた。
タンパク質とリガンドに対して$2.0 \, \text{kcal/mol/\AA}^2$の拘束を加えた。

続いて、NVT条件下で200 $\rm{ps}$のシミュレーションを行った。
langevin法を用いた温度制御を行いながら、$T = 310 \rm{[K]}$で設定した。
タンパク質とリガンドの位置拘束の重みを$0.1 \, \text{kcal/mol/\AA}^2$に設定した。

続いて、上記と同様のNVT条件下で、今度は位置拘束を全て外して、200 $\rm{ps}$のシミュレーションを行った。

最後に、NP\gamma T条件下で700 $\rm{ps}$のシミュレーションを行った。
langevin法を用いた温度制御とBerendsen法を用いた圧力制御を行いながら、$T = 310 \rm{[K]}$で設定した。
位置拘束を外し、膜系のシミュレーション用に表面張力\gamma = 17 \, \text{dyne/cm}で設定した。

\subsection{サンプリング}
ここではNP\gamma Tシミュレーションによるサンプリングを56 $\rm{ns}$行った。
設定は、熱平衡化で行ったNP\gamma Tシミュレーションと同様である.

\subsection{保存された結晶水の同定}
保存された結晶水を同定するために、サンプリングで得られたシミュレーションデータから水分子の位置とその密度を分析した。
具体的には、シミュレーションの各タイムステップで得られる水分子の座標を格子状に集約し、サンプリングで得られたトラジェクトリの半分以上で保存されている水分子を同定した。

\subsection{NVE}
最後にNVEシミュレーションによるサンプリングを行った。
初期状態として、NP\gamma Tシミュレーションによるサンプリングで得られた座標と速度を用いた。
保存した座標と速度のうち、2つを使って\Delta t = 0.5 fs、1000 $\rm{ps}$のシミュレーションを実行した。
最終的に、inactive状態active状態双方で1000psトラジェクトリを計10本取得した。

\section{グラフ理論}
\label{sec:graph theory}

\subsection{ネットワーク構築}
グラフ理論では、タンパク質のアミノ酸残基の相互作用を、ノードとエッジを用いたアミノ酸ネットワークとして表すことができる。
\begin{itemize}
  \item \textbf{ノード}：アミノ酸残基（原子やタンパク質全体も可能）
  \item \textbf{エッジ}：ノード同士の相互作用
\end{itemize}

そしてエッジに重みづけをすることで、エッジを同じ距離1とするのではなく、各結合ごとに強度を振り分けることが可能である。

本研究では、ノードをアミノ酸残基とし、以下の条件に基づいてエッジを形成した。
1. 残基ペア間の最短距離が3\,\text{\AA}未満である場合、エッジを形成する。
2. アミノ酸配列上で隣接する残基感のエッジは削除する。
ここで、残基ペア間の最短距離は、NVEトラジェクトリの全フレームの座標を時間平均することで得られた平均構造を用いて計算したものである。
隣接する残基間のエッジを削除した理由は、本研究ではinactive状態からactive状態へのアロステリック転移に寄与する、より長距離で特異的なnative contactに焦点を当てるためである。

エッジの重みづけとして、残基間最短距離の2乗逆数の平均$\langle \frac{1}{d^2} \rangle$ を用いた。

これは、エネルギー移動速度は残基間距離の2乗平均に反比例し、
距離が短いほどエネルギーのやり取りが効率的で移動速度が早くなる一方、
距離が長くなるにつれてエネルギーの分散が増加し移動速度が遅くなるという
振動エネルギー移動の物理的挙動を正確に記述している\cite{buchenberg2015}。
この特性を活用し、本研究でも局所的なエネルギー移動効率を反映したネットワークを構築した。
%https://pubs.acs.org/doi/10.1021/acs.jpclett.5b02514


\subsection{Louvain法によるコミュニティ検出}

Louvain法は、ネットワークにおけるコミュニティ構造を検出するための効率的なアルゴリズムである。
本研究では、Louvain法\cite{Blondel2008}を実装してネットワークデータを解析し、最適なコミュニティ分割とモジュラリティの評価を行った。
%louvain方の引用2008
%https://iopscience.iop.org/article/10.1088/1742-5468/2008/10/P10008/meta?casa_token=gUnIfMpEgFUAAAAA:CzncxXVCSbFF0gBux5xGhAWMnQDOio3eBOyMY8VDngPf7-LFexsnOz5gan6uHE0dlL7JrLJQAdwuwauUSrrCsmDHg0g
\subsubsection{モジュラリティの定義}
モジュラリティ$Q$は、ネットワーク内で検出されたコミュニティ構造の質を評価する尺度である。
具体的には、同一コミュニティ内に存在するエッジの密度が、ランダムに生成されたネットワークと比較してどれだけ顕著に密集しているかを示す。
モジュラリティは次式で定義される：
\begin{equation}
Q = \sum_{c \in \text{コミュニティ}} \left( \frac{m_c}{m} - \left( \frac{K_c}{2m} \right)^2 \right),
\end{equation}
ここで、$m_c$はコミュニティ$c$内のエッジの重み合計、$m$はネットワーク全体のエッジの重み合計、$K_c$はコミュニティ$c$内のノードの次数の合計である。
この定義により、同一コミュニティ内でのエッジ密度が高い場合にモジュラリティの値が大きくなり、ネットワークのコミュニティ構造がより明確であることを示す。

\subsubsection{アルゴリズムの流れ}
Louvain法は以下の2つのステップを繰り返してコミュニティを検出する：
\begin{enumerate}
    \item \textbf{局所移動ステップ:} 各ノードを隣接するコミュニティに移動させ、モジュラリティの増加が最大となる配置を探索する。
    このプロセスにおいて、モジュラリティの変化量$\Delta Q$は以下で計算される：
    \begin{equation}
    \Delta Q = \Delta Q_{\text{削除}} + \Delta Q_{\text{挿入}},
    \end{equation}
    ここで、$\Delta Q_{\text{削除}}$はノードを元のコミュニティから削除した際のモジュラリティの変化量、$\Delta Q_{\text{挿入}}$はノードを新たなコミュニティに追加した際のモジュラリティの変化量である。
    \item \textbf{集約ステップ:} 検出されたコミュニティを1つのノードとして扱い、新しいネットワークを構築する。この操作を通じて、階層的なコミュニティ構造を得ることが可能である。
\end{enumerate}

本研究では、Pythonを用いてLouvain法を実装した。
モジュラリティの増加が小さい場合に収束するよう、収束条件として閾値$\epsilon = 10^{-7}$を設定した。
また、ノードの移動においてランダム性を導入し、複数回の試行によりモジュラリティの最適解を探索した。
そして、100回の試行の中で最大のモジュラリティおよびその標準偏差と標準誤差を算出した。